<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مولد استوری Masterpiece - نسخه نهایی و پایدار</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
    function toJalali(gy, gm, gd) {
        var g_d_m = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
        var jy = (gy <= 1600) ? 0 : 979; gy -= (gy <= 1600) ? 621 : 1600; var gy2 = (gm > 2) ? (gy + 1) : gy;
        var days = 365 * gy + parseInt((gy2 + 3) / 4) - parseInt((gy2 + 99) / 100) + parseInt((gy2 + 399) / 400) - 80 + gd + g_d_m[gm - 1];
        jy += 33 * parseInt(days / 12053); days %= 12053; jy += 4 * parseInt(days / 1461); days %= 1461;
        jy += parseInt((days - 1) / 365); if (days > 365) days = (days - 1) % 365;
        var jm = (days < 186) ? 1 + parseInt(days / 31) : 7 + parseInt((days - 186) / 30);
        var jd = 1 + ((days < 186) ? (days % 31) : ((days - 186) % 30)); return [jy, jm, jd];
    }
    </script>
    
    <style>
        /* --- تغییر کلیدی: جاسازی فونت‌های بی‌نقص به صورت مستقیم برای حل مشکل امنیتی و رندرینگ --- */
        @font-face {
            font-family: 'Vazirmatn';
            src: url(data:font/woff2;charset=utf-8;base64,d09GMgABAAAAAAVwAA0AAAAACBgAAAUHAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmAAVBEICgkgB9gJBgUuAAE2AiQDDAQgBYgmA2cPiAABFgYce9/2cR9uA//k87/r13xR0zRJVU3T9nZmd2Zne9/slESxIkoEBJESIBiABAQEiA4g/v/f3d2fM4GYd/8A2I7/f1/p/9/+/f1LgD/QAAAAEAEAMACAYAAQAAAAAAAAAAAACQAAAABACAAAgAAAAAAGQAZAAAAAEAAoAADwAAACA9ADoAJAAGAFoATgA6AFgAZgBuAHoAgACGAIgAjgCUAJoAnACiAKgArACuALAAsgC6ALwAwwDFAMwA0wDYAN4A4gDjAOYA6wDwAPgA/AEAAQIBBgEKAQwBEgEUAQABLQFSAWMBbAGBAYMBhwGRAZUBmgGdAaYBqgGxAbYBvQHEAcwBzgHSAdoB4AHpAfMB+wIBAhUCOgJCAkYCVgJgAm0CcwJ4AogCjwKOApcCoQKiAq0CtAK5AsECuwLGAsoC0ALbAuQC5QLxAvYC+wMKAxIDHgMgAy0DMgM+A0ADSQNSA1kDYgNpA3IDdgN8A4IDiAOWAAAAAAAAAAkAAAAAAAAADgA8AFwAbgCEAJQApgCoALgAxgDWAPAA/gEMAWwBlAGgAbIBzgHiAfsCIQJFAmACdAKQAqsC1ALrAwwDIwM/A08DbwONAAYADwARABMABAAsADgARAAmACEABgAbABsAFQANAA8AFAAAAL+amZk/r52/mZq/nZkAAAAAAAEAr5oA/gFeAQAAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAgIAAg-EAAABQAAAAC4AIAAgABAAAA4IAA0AAAADwYAAADwAgADAAAA-gIACQAAAPgDAAkAAAD6BAAJAAD8BgAJAAD_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AQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAAEBAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AA-AA-D</strong>-AIBAAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP8AAQAAAAAAAP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zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz-z/d/PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP-f/privew-container { max-width: 420px; }

        h2, h3 { color: #333; border-bottom: 2px solid var(--primary-accent-color); padding-bottom: 10px; margin: 0 0 25px 0; font-family: 'Vazirmatn', sans-serif; }
        
        .control-panel { display: grid; grid-template-columns: 1fr 1fr; gap: 15px 20px; }
        .control-group { display: flex; flex-direction: column; }
        .control-group.full-width { grid-column: 1 / -1; }
        .control-group label { margin-bottom: 10px; font-weight: bold; color: #555; font-size: 0.95em; }
        
        .select-wrapper { position: relative; }
        .select-wrapper::after { content: '▾'; font-size: 1.5em; color: #aaa; position: absolute; left: 15px; top: 50%; transform: translateY(-50%); pointer-events: none; }
        select { width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid #ced4da; font-family: inherit; background-color: #f8f9fa; -webkit-appearance: none; appearance: none; }
        
        input[type="range"] { width: 100%; height: 8px; background: #e9ecef; border-radius: 5px; outline: none; -webkit-appearance: none; appearance: none; }
        input[type="range"]::-webkit-slider-thumb { width: 20px; height: 20px; background: var(--primary-accent-color); border-radius: 50%; cursor: pointer; -webkit-appearance: none; appearance: none; }
        
        .color-picker-wrapper { display: flex; align-items: center; gap: 10px; }
        input[type="color"] { -webkit-appearance: none; appearance: none; width: 32px; height: 32px; padding: 0; border: none; border-radius: 50%; cursor: pointer; background-color: transparent; }
        input[type="color"]::-webkit-color-swatch { border-radius: 50%; border: 2px solid #e0e0e0; }
        
        #text-input { width: 100%; height: 120px; padding: 10px; font-size: 1em; border-radius: 8px; margin-bottom: 20px; resize: vertical; border: 1px solid #ced4da; box-sizing: border-box;}
        #story-background { width: 360px; height: 640px; background-color: var(--story-bg-color); border-radius: 25px; display: flex; align-items: center; justify-content: center; padding: 20px; transition: background-color 0.3s; }
        #capture-area { width: 100%; height: 100%; background-color: var(--card-bg-color); border-radius: 20px; box-shadow: 0 15px 45px rgba(0,0,0,0.2); display: flex; flex-direction: column; overflow: hidden; }
        
        .post-container { flex-grow: 1; display: flex; flex-direction: column; padding: 30px 25px 0; direction: rtl; overflow: hidden; }
        #image-preview-container { display: flex; justify-content: center; margin-bottom: 20px; flex-shrink: 0; }
        #uploaded-image { max-width: 100%; height: auto; object-fit: contain; }
        
        .channel-name, .message-text { text-rendering: optimizeLegibility; }
        .channel-name { font-weight: bold; color: var(--primary-text-color); margin-bottom: 15px; font-size: 1.1em; flex-shrink: 0; }
        .message-text { font-size: 17px; line-height: 2; color: var(--primary-text-color); white-space: pre-wrap; word-wrap: break-word; text-align: justify; overflow-y: auto; flex-grow: 1; padding-bottom: 15px; }
        
        .content-meta-footer { display: none; flex-shrink: 0; position: relative; align-items: center; padding: 10px 25px; border-top: 1px dashed #ccc; color: var(--meta-text-color); font-size: 0.8em; }
        #meta-datetime-display { direction: ltr; }
        #meta-page-indicator { position: absolute; left: 50%; transform: translateX(-50%); font-weight: bold; }

        .ad-footer { flex-shrink: 0; background-color: var(--footer-bg-color); color: #444; padding: 15px 25px; border-top: 1px solid #e9ecef; direction: rtl; }
        .footer-info { margin-bottom: 15px; }
        .footer-item { display: flex; align-items: center; gap: 12px; font-size: 0.9em; }
        .footer-item:first-child { margin-bottom: 10px; }
        .footer-icon svg { width: 18px; height: 18px; fill: #555; }
        
        .footer-brand { border-top: 1px solid #dee2e6; padding-top: 15px; text-align: center; }
        #brand-svg { width: 100%; height: 40px; }
        #brand-svg-text { font-family: 'Estedad', sans-serif; font-size: 28px; font-weight: 900; fill: var(--primary-text-color); text-anchor: middle; letter-spacing: 0.5px; }
        
        #export-button, #remove-image-btn { margin-top: 25px; padding: 15px; font-size: 1.2em; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; width: 100%; transition: all 0.2s; }
        #export-button { background-image: linear-gradient(45deg, var(--primary-accent-color), #0a58ca); color: white; }
        #export-button:disabled { background-image: none; background-color: #6c757d; cursor: wait;}
        #remove-image-btn { background-image: linear-gradient(45deg, #dc3545, #b02a37); color: white; margin-top: 10px; }
    
        .page-navigator { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-top: 15px; }
        .page-navigator button { background-color: var(--primary-accent-color); color: white; border: none; border-radius: 8px; font-size: 1.5em; font-weight: bold; cursor: pointer; width: 50px; height: 40px; transition: background-color 0.2s; }
        .page-navigator button:hover:not(:disabled) { background-color: #0a58ca; }
        .page-navigator button:disabled { background-color: #ced4da; cursor: not-allowed; }
        #page-indicator { font-size: 1.1em; font-weight: bold; color: #555; }
    </style>
</head>
<body>
    <div class="container panel-container">
        <h2>۱. ورود محتوا</h2>
        <textarea id="text-input" placeholder="خط اول: عنوان (فقط در صفحه اول).&#10;ادامه متن: محتوای شما.&#10;برای صفحه جدید، دو بار اینتر بزنید."></textarea>
        <h2>۲. پنل طراحی حرفه‌ای</h2>
        <div class="control-panel">
             <div class="control-group"> <label>رنگ پس زمینه</label> <div class="color-picker-wrapper"><input type="color" id="background-color-picker" value="#ffde59"></div> </div>
             <div class="control-group"> <label>رنگ کارت</label> <div class="color-picker-wrapper"><input type="color" id="card-color-picker" value="#ffffff"></div> </div>
             <div class="control-group"> <label>رنگ متن</label> <div class="color-picker-wrapper"><input type="color" id="text-color-picker" value="#212529"></div> </div>
             <div class="control-group"> <label for="text-align-selector">چینش متن</label> <div class="select-wrapper"><select id="text-align-selector"> <option value="justify" selected>دو طرفه</option> <option value="right">راست‌چین</option> <option value="center">وسط‌چین</option> </select></div> </div>
             <div class="control-group full-width"> <label for="font-size-slider">اندازه فونت متن</label> <input type="range" id="font-size-slider" min="12" max="26" value="17" step="1"> </div>
             <div class="control-group full-width"> <label for="line-height-slider">فاصله بین خطوط</label> <input type="range" id="line-height-slider" min="1.4" max="2.8" value="2" step="0.1"> </div>
             <div class="control-group full-width"> <label for="font-selector">فونت متن</label> <div class="select-wrapper"><select id="font-selector"> <option value="Vazirmatn">وزیرمتن</option> <option value="Estedad">استعداد</option> <option value="Lalezar">لاله‌زار</option> </select></div> </div>
             <div class="control-group full-width"> <label for="font-uploader">آپلود فونت متن (اختیاری)</label> <input type="file" id="font-uploader" accept=".ttf,.woff,.woff2"> </div>
             <div class="control-group full-width"> <label for="image-uploader">آپلود تصویر برای صفحه فعلی</label> <input type="file" id="image-uploader" accept="image/png"> </div>
             <div class="control-group full-width" id="image-controls" style="display: none;">
                 <label for="image-size-slider">اندازه تصویر</label> <input type="range" id="image-size-slider" min="20" max="90" value="50">
                 <button id="remove-image-btn">حذف تصویر این صفحه</button>
             </div>
        </div>
        <button id="export-button">ساخت استوری نهایی</button>
    </div>
    <div class="container preview-container">
        <h3>۳. پیش‌نمایش زنده</h3>
        <div id="story-background">
            <div id="capture-area">
                <div class="post-container">
                    <div id="image-preview-container" style="display: none;"> <img id="uploaded-image" src="" alt="Uploaded Image"> </div>
                    <div id="channel-name-display" class="channel-name"></div>
                    <div id="message-text-display" class="message-text"></div>
                </div>
                <div class="content-meta-footer" id="content-meta-footer">
                    <span id="meta-datetime-display"></span>
                    <span id="meta-page-indicator"></span>
                </div>
                <div class="ad-footer">
                    <div class="footer-info">
                        <div class="footer-item">
                            <div class="footer-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg> </div>
                            <span>خوزستان، اندیمشک، شهرآزادی، بوستان ۲</span>
                        </div>
                        <div class="footer-item">
                            <div class="footer-icon"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M164.9 24.6c-7.7-18.6-28-28.5-47.4-23.2l-88 24C12.1 30.2 0 46 0 64C0 311.4 200.6 512 448 512c18 0 33.8-12.1 38.6-29.5l24-88c5.3-19.4-4.6-39.7-23.2-47.4l-96-40c-16.3-6.8-35.2-2.1-46.3 11.6L304.7 368C234.3 334.7 177.3 277.7 144 207.3L193.3 167c13.7-11.2 18.4-30 11.6-46.3l-40-96z"/></svg> </div>
                            <strong>09165906606</strong>
                        </div>
                    </div>
                    <div class="footer-brand">
                        <svg id="brand-svg" viewBox="0 0 320 50"> <text id="brand-svg-text" x="50%" y="50%" dominant-baseline="middle">کافی نت ایمان جاتی</text> </svg>
                    </div>
                </div>
            </div>
        </div>
        <div class="page-navigator">
            <button id="prev-page-btn">&lt;</button>
            <span id="page-indicator">۱ / ۱</span>
            <button id="next-page-btn">&gt;</button>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // === ارجاع به تمام المان‌ها ===
        const textInput = document.getElementById('text-input');
        const messageTextDisplay = document.getElementById('message-text-display');
        const channelNameDisplay = document.getElementById('channel-name-display');
        const backgroundColorPicker = document.getElementById('background-color-picker');
        const cardColorPicker = document.getElementById('card-color-picker');
        const textColorPicker = document.getElementById('text-color-picker');
        const fontSelector = document.getElementById('font-selector');
        const fontUploader = document.getElementById('font-uploader');
        const textAlignSelector = document.getElementById('text-align-selector');
        const fontSizeSlider = document.getElementById('font-size-slider');
        const lineHeightSlider = document.getElementById('line-height-slider');
        const exportButton = document.getElementById('export-button');
        const root = document.documentElement;
        const imageUploader = document.getElementById('image-uploader');
        const imageControls = document.getElementById('image-controls');
        const imageSizeSlider = document.getElementById('image-size-slider');
        const removeImageBtn = document.getElementById('remove-image-btn');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const uploadedImage = document.getElementById('uploaded-image');
        const contentMetaFooter = document.getElementById('content-meta-footer');
        const metaDatetimeDisplay = document.getElementById('meta-datetime-display');
        const metaPageIndicator = document.getElementById('meta-page-indicator');
        const prevPageBtn = document.getElementById('prev-page-btn');
        const nextPageBtn = document.getElementById('next-page-btn');
        const pageIndicator = document.getElementById('page-indicator');

        // === متغیرهای سراسری برای مدیریت وضعیت ===
        let pages = [];
        let pageImages = [];
        let currentPageIndex = 0;
        let globalChannelName = "اطلاع رسان خبر";
        let currentDateTimeString = '';

        // === توابع اصلی ===

        function toJalali(gy, gm, gd) {
            var g_d_m = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
            var jy = (gy <= 1600) ? 0 : 979; gy -= (gy <= 1600) ? 621 : 1600; var gy2 = (gm > 2) ? (gy + 1) : gy;
            var days = 365 * gy + parseInt((gy2 + 3) / 4) - parseInt((gy2 + 99) / 100) + parseInt((gy2 + 399) / 400) - 80 + gd + g_d_m[gm - 1];
            jy += 33 * parseInt(days / 12053); days %= 12053; jy += 4 * parseInt(days / 1461); days %= 1461;
            jy += parseInt((days - 1) / 365); if (days > 365) days = (days - 1) % 365;
            var jm = (days < 186) ? 1 + parseInt(days / 31) : 7 + parseInt((days - 186) / 30);
            var jd = 1 + ((days < 186) ? (days % 31) : ((days - 186) % 30)); return [jy, jm, jd];
        }

        function updateDateTime() {
            const now = new Date(); 
            const timeString = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            const jalaliDateArray = toJalali(now.getFullYear(), now.getMonth() + 1, now.getDate());
            const dateString = `${jalaliDateArray[0]}/${jalaliDateArray[1].toString().padStart(2, '0')}/${jalaliDateArray[2].toString().padStart(2, '0')}`;
            currentDateTimeString = `${dateString} - ${timeString}`;
        }
        
        function processTextInput() {
            const fullText = textInput.value;
            if (fullText.trim() === '') {
                globalChannelName = "اطلاع رسان خبر";
                pages = ["محتوای شما در اینجا نمایش داده می‌شود..."];
                pageImages = [null];
                currentPageIndex = 0;
                renderCurrentPage();
                return;
            }
            const allLines = fullText.split(/\r?\n/);
            globalChannelName = allLines[0].trim() || "اطلاع رسان خبر";
            const contentBody = allLines.slice(1).join('\n');
            const pageDelimiter = /(\r?\n\s*){2,}/;
            const newPages = contentBody.split(pageDelimiter).filter(p => p && p.trim() !== '');

            if (newPages.length === 0 && contentBody.trim() !== '') { pages = [contentBody.trim()]; } 
            else if (newPages.length > 0) { pages = newPages; } 
            else { pages = [""]; }

            const newPageImages = new Array(pages.length).fill(null);
            for (let i = 0; i < Math.min(pageImages.length, newPageImages.length); i++) {
                newPageImages[i] = pageImages[i];
            }
            pageImages = newPageImages;
            
            if (currentPageIndex >= pages.length) { currentPageIndex = Math.max(0, pages.length - 1); }
            renderCurrentPage();
        }

        function renderCurrentPage() {
            if (!pages) return;
            channelNameDisplay.style.display = (currentPageIndex === 0) ? 'block' : 'none';
            channelNameDisplay.innerText = (currentPageIndex === 0) ? globalChannelName : '';
            messageTextDisplay.innerText = pages[currentPageIndex] || "";

            const currentImage = pageImages[currentPageIndex];
            if (currentImage) {
                imagePreviewContainer.style.display = 'flex';
                uploadedImage.src = currentImage.src;
                uploadedImage.style.width = currentImage.size + '%';
                imageControls.style.display = 'block';
                imageSizeSlider.value = currentImage.size;
            } else {
                imagePreviewContainer.style.display = 'none';
                uploadedImage.src = '';
                imageControls.style.display = 'none';
            }

            contentMetaFooter.style.display = (pages.length > 1) ? 'flex' : 'none';
            if (pages.length > 1) {
                metaDatetimeDisplay.textContent = currentDateTimeString;
                metaPageIndicator.textContent = `صفحه ${currentPageIndex + 1} از ${pages.length}`;
            }
            pageIndicator.textContent = `${currentPageIndex + 1} / ${pages.length || 1}`;
            prevPageBtn.disabled = currentPageIndex === 0;
            nextPageBtn.disabled = currentPageIndex >= pages.length - 1;
        }

        nextPageBtn.addEventListener('click', () => { if (currentPageIndex < pages.length - 1) { currentPageIndex++; renderCurrentPage(); } });
        prevPageBtn.addEventListener('click', () => { if (currentPageIndex > 0) { currentPageIndex--; renderCurrentPage(); } });

        imageUploader.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    pageImages[currentPageIndex] = { src: e.target.result, size: 50 };
                    renderCurrentPage();
                };
                reader.readAsDataURL(file);
            }
        });

        removeImageBtn.addEventListener('click', function() {
            pageImages[currentPageIndex] = null;
            imageUploader.value = null;
            renderCurrentPage();
        });

        imageSizeSlider.addEventListener('input', function() {
            if (pageImages[currentPageIndex]) {
                pageImages[currentPageIndex].size = this.value;
                uploadedImage.style.width = this.value + '%';
            }
        });
        
        function updateStoryBackgroundColor() { root.style.setProperty('--story-bg-color', backgroundColorPicker.value); }
        function updateCardColor() { 
            root.style.setProperty('--card-bg-color', cardColorPicker.value); 
            root.style.setProperty('--footer-bg-color', cardColorPicker.value);
        }
        function updateTextColor() { root.style.setProperty('--primary-text-color', textColorPicker.value); }
        function updateFont() { messageTextDisplay.style.fontFamily = fontSelector.value; }
        function updateTextAlign() { messageTextDisplay.style.textAlign = textAlignSelector.value; }
        function updateFontSize() { messageTextDisplay.style.fontSize = fontSizeSlider.value + 'px'; }
        function updateLineHeight() { messageTextDisplay.style.lineHeight = lineHeightSlider.value; }

        fontUploader.addEventListener('change', function(event) {
            const file = event.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const fontDataUrl = e.target.result; 
                const customFontName = 'CustomUserFont' + Date.now();
                const oldStyle = document.getElementById('custom-font-style');
                if (oldStyle) oldStyle.remove();
                
                const newStyle = document.createElement('style');
                newStyle.id = 'custom-font-style';
                newStyle.textContent = `@font-face { font-family: '${customFontName}'; src: url('${fontDataUrl}'); }`;
                document.head.appendChild(newStyle);
                
                let customOption = fontSelector.querySelector('option[value="custom"]');
                if (!customOption) {
                    customOption = document.createElement('option'); 
                    customOption.value = 'custom';
                    fontSelector.appendChild(customOption);
                }
                customOption.textContent = file.name;
                customOption.dataset.fontName = customFontName;
                customOption.selected = true;
                messageTextDisplay.style.fontFamily = customFontName;
            };
            reader.readAsDataURL(file);
        });
        
        fontSelector.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            if (selectedOption.value === 'custom') {
                messageTextDisplay.style.fontFamily = selectedOption.dataset.fontName;
            } else {
                messageTextDisplay.style.fontFamily = this.value;
            }
        });

        textInput.addEventListener('input', processTextInput);
        backgroundColorPicker.addEventListener('input', updateStoryBackgroundColor);
        cardColorPicker.addEventListener('input', updateCardColor);
        textColorPicker.addEventListener('input', updateTextColor);
        fontSizeSlider.addEventListener('input', updateFontSize);
        lineHeightSlider.addEventListener('input', updateLineHeight);
        
        // *** راه‌حل نهایی و قطعی برای محیط آنلاین ***
        exportButton.addEventListener('click', async function() {
            const node = document.getElementById('story-background');
            
            exportButton.disabled = true;
            exportButton.textContent = 'در حال ساخت...';

            try {
                document.querySelector('.message-text').scrollTop = 0;
                
                const canvas = await html2canvas(node, {
                    scale: 3,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: null,
                    logging: false,
                    letterRendering: true
                });

                const dataUrl = canvas.toDataURL('image/png', 1.0);
                const link = document.createElement('a');
                const pageNumText = pages.length > 1 ? `Page-${currentPageIndex + 1}-` : '';
                link.download = `Kafinet-Iman-${pageNumText}${Date.now()}.png`;
                link.href = dataUrl;
                link.click();

            } catch (error) {
                console.error('An error occurred while creating the image:', error);
                alert('متاسفانه در ساخت عکس خطایی رخ داد. این خطا معمولا به دلیل مشکلات شبکه یا بارگذاری فونت است. لطفا صفحه را رفرش کرده و دوباره تلاش کنید.');
            } finally {
                exportButton.disabled = false;
                exportButton.textContent = 'ساخت استوری نهایی';
            }
        });
        
        // === اجرای اولیه در زمان بارگذاری صفحه ===
        updateDateTime();
        processTextInput(); 
        updateStoryBackgroundColor(); 
        updateCardColor(); 
        updateTextColor(); 
        updateFont(); 
        updateTextAlign(); 
        updateFontSize(); 
        updateLineHeight();
    });
    </script>

</body>
</html>
